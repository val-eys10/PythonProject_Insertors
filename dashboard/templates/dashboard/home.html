{% extends 'dashboard/base.html' %}
{% load static %}
{% block title %}Dashboard | Fitness Analyzer{% endblock %}

{% block content %}

<div class="row">

    {% include 'dashboard/components/sidebar.html' %}

    <div class="col-md-9 p-4 main">
        <!-- Replaced separate headings with a responsive flex container -->
        <div class="d-flex flex-column flex-md-row align-items-center justify-content-between mb-4">
            <h1 class="mb-0">Dashboard</h1>
            <h2 class="mb-0 mt-3 mt-md-0 text-center text-md-end h5">Welcome, {{ request.user.username }}!</h2>
        </div>


        <div class="flex-card">

            <div class="flex-card-item">
                <h2 class="statusTitle">Status Report</h2>
                {% if next_week_bmi and next_week_steps %}

                <h5>ðŸ“… Next Weekâ€™s Fitness Forecast</h5>
                <p>Predicted BMI: <strong>{{ next_week_bmi }}</strong></p>
                <p>Predicted Steps: <strong>{{ next_week_steps }}</strong></p>
                <hr>
                <p class="mb-0">{{ motivation }}</p>

                {% else %}
                <p>{{ motivation }}</p>
                {% endif %}
            </div>

            <div class="flex-card-item">
                <h2 class="statusTitle">Average Stats</h2>
                <p><b>Average Steps:</b> {{ avg_steps }}</p>
                <p><b>Average Calories Burned:</b> {{ avg_calories }}</p>
            </div>
        </div>



        <div class="">
            <h5>Fitness Data Records</h5>
            <div class="table-responsive">
                <table class="table text-center align-middle">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Weight (kg)</th>
                            <th>Height (m)</th>
                            <th>BMI</th>
                            <th>Steps</th>
                            <th>Calories</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for record in user_data %}
                        <tr>
                            <td>{{ record.date }}</td>
                            <td>{{ record.weight }}</td>
                            <td>{{ record.height }}</td>
                            <td>{{ record.bmi }}</td>
                            <td>{{ record.steps }}</td>
                            <td>{{ record.calories_burned }}</td>
                        </tr>
                        {% empty %}
                        <tr>
                            <td colspan="6">No records yet.</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>

        <div class="card mb-4">
            <h5>BMI Trend</h5>
            {% if plot_data %}
            <img id="bmiChart" src="data:image/png;base64,{{ bmi_chart_light }}" class="img-fluid rounded"
                alt="BMI Chart">
            {% else %}
            <p>No data to display graph.</p>
            {% endif %}
        </div>

        <div class="card mb-4">
            <h5>Weight Trend</h5>
            {% if weight_chart %}
            <img id="weightChart" src="data:image/png;base64,{{ weight_chart_light }}" class="img-fluid rounded"
                alt="Weight Chart">
            {% else %}
            <p>No weight data to display.</p>
            {% endif %}
        </div>



    </div>
</div>

{% endblock %}